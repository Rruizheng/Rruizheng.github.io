(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{356:function(a,s,e){a.exports=e.p+"assets/img/1.eb1fe9d6.png"},357:function(a,s,e){a.exports=e.p+"assets/img/2.1b0534fa.png"},358:function(a,s,e){a.exports=e.p+"assets/img/3.2139d813.png"},448:function(a,s,e){"use strict";e.r(s);var t=e(14),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"puppeteer使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#puppeteer使用"}},[a._v("#")]),a._v(" Puppeteer使用")]),a._v(" "),s("blockquote",[s("p",[a._v("最近在使用lighthouse和puppeteer进行一些性能测试相关的工作，感觉puppeteer还是很好用的，下面简单介绍一下puppeteer的使用")])]),a._v(" "),s("h3",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[a._v("#")]),a._v(" 概念")]),a._v(" "),s("h4",{attrs:{id:"headless-chrome"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#headless-chrome"}},[a._v("#")]),a._v(" Headless Chrome")]),a._v(" "),s("ul",[s("li",[a._v("是一种在无界面的环境中运行 Chrome，与正常Chrome的区别\n"),s("ul",[s("li",[a._v("直接通过命令行或者程序语言操作")]),a._v(" "),s("li",[a._v("没有界面，少了加载 css/js、渲染页面的工作，比真实浏览器更快，更稳定")])])]),a._v(" "),s("li",[a._v("在启动 Chrome 时添加参数 --headless，便可以 headless 模式启动 Chrome")])]),a._v(" "),s("h4",{attrs:{id:"puppeteer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#puppeteer"}},[a._v("#")]),a._v(" Puppeteer")]),a._v(" "),s("ul",[s("li",[a._v("是 Node.js 工具引擎")]),a._v(" "),s("li",[a._v("是 Chrome Developer Protocol 的上层封装")]),a._v(" "),s("li",[a._v("提供了高级API来通过DevTools协议控制Chrome或Chromium")]),a._v(" "),s("li",[a._v("默认是headless，可通过参数配置调出界面")])]),a._v(" "),s("h4",{attrs:{id:"puppeteer可以做什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#puppeteer可以做什么"}},[a._v("#")]),a._v(" Puppeteer可以做什么")]),a._v(" "),s("ul",[s("li",[a._v("生成页面的屏幕截图和PDF。（包括滚动元素的全屏截图）")]),a._v(" "),s("li",[a._v("爬取SPA（单页应用程序）并生成预渲染的内容（即“ SSR”（服务器端渲染））。")]),a._v(" "),s("li",[a._v("自动进行表单提交，UI测试，键盘输入等。")]),a._v(" "),s("li",[a._v("创建最新的自动化测试环境。使用最新的JavaScript和浏览器功能，直接在最新版本的Chrome中运行测试。")]),a._v(" "),s("li",[a._v("捕获站点的时间线跟踪，以帮助诊断性能问题。")]),a._v(" "),s("li",[a._v("测试Chrome扩展程序。")])]),a._v(" "),s("h4",{attrs:{id:"文档资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文档资源"}},[a._v("#")]),a._v(" 文档资源")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/GoogleChrome/puppeteer",target:"_blank",rel:"noopener noreferrer"}},[a._v("Puppteer Github 页面"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://pptr.dev/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Puppteer API 定义"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://zhaoqize.github.io/puppeteer-api-zh_CN/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Puppteer API 定义（中文版）"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[a._v("#")]),a._v(" API")]),a._v(" "),s("p",[a._v("结合API文档使用\n"),s("img",{attrs:{src:e(356),alt:"image.png"}})]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Browser： 对应一个浏览器实例\nBrowserContext： 对应浏览器一个上下文会话\nPage：表示一个 Tab 页面\nFrame: 一个框架\nExecutionContext： javascript 的执行环境\nElementHandle: 对应 DOM 的一个元素节点\nJsHandle：对应 DOM 中的 javascript 对象CDPSession：可以直接与原生的 CDP 进行通信\nCoverage：获取 JavaScript 和 CSS 代码覆盖率\nTracing：抓取性能数据进行分析\nResponse： 页面收到的响应\nRequest： 页面发出的请求\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h3",{attrs:{id:"puppeteer-recoder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#puppeteer-recoder"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/puppeteer/recorder",target:"_blank",rel:"noopener noreferrer"}},[a._v("Puppeteer-Recoder"),s("OutboundLink")],1)]),a._v(" "),s("ul",[s("li",[a._v("可以直接记录与浏览器进行交互，生成Puppeteer脚本。")]),a._v(" "),s("li",[a._v("可以在chrome中添加插件直接使用")]),a._v(" "),s("li",[a._v("缺点：无法记录滚动操作")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("点击record开始记录")]),a._v(" "),s("th",[a._v("生成代码可直接运行")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("img",{attrs:{src:e(357),alt:"image.png"}})]),a._v(" "),s("td",[s("img",{attrs:{src:e(358),alt:"image.png"}})])])])]),a._v(" "),s("h3",{attrs:{id:"一些简单的例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些简单的例子"}},[a._v("#")]),a._v(" 一些简单的例子")]),a._v(" "),s("h4",{attrs:{id:"网页截图功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网页截图功能"}},[a._v("#")]),a._v(" 网页截图功能")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("const puppeteer = require('puppeteer');\n\n(async () => {\n  // 生成browser实例\n  const browser = await puppeteer.launch();  \n  \n  // 解析一个新的页面。页面是在默认浏览器上下文创建的\n  const page = await browser.newPage();\n  \n  // 设置网页大小\n  await page.setViewport({ width: 1000, height: 500 });\n  \n  // 跳转到 https://example.com, 这里可以增加一些参数配置\n  await page.goto('https://example.com');\n  \n  // 生成图片\n  await page.screenshot({path: 'example.png'});\n\n  // 生成pdf\n  await page.pdf({path: 'page.pdf'});\n\n  await browser.close();\n})();\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br")])]),s("h4",{attrs:{id:"如果想调出界面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果想调出界面"}},[a._v("#")]),a._v(" 如果想调出界面")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("const browserConfig = {\n    headless: false \n};\nconst browser = await puppeteer.launch(browserConfig);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h4",{attrs:{id:"如果想截图滚动元素"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果想截图滚动元素"}},[a._v("#")]),a._v(" 如果想截图滚动元素")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("// 针对滚动元素截屏\nasync function scrollElementShot(page, selectorName, outputPath) {\n    // 选中滚动元素\n\tconst scrollableSectionEl = await page.waitForSelector(selectorName);\n\t\n\t// 获取滚动元素参数\n\tconst bounding_box = await scrollableSectionEl.boundingBox();\n\n\tawait scrollableSectionEl.screenshot({\n\t\tpath: outputPath,\n\t\tclip: bounding_box\n\t});\n}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h4",{attrs:{id:"如果设置不同网络状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果设置不同网络状态"}},[a._v("#")]),a._v(" 如果设置不同网络状态")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("// 一些网络状态\nconst NETWORK_PRESETS = {\n    // 所有速度 / 8 是因为网络速度通常以比特/秒,而 DevTools 预计吞吐量在字节/秒! （1字节 = 8比特）\n    GPRS: {\n        offline: false, // 是否连接\n        downloadThroughput: (50 * 1024) / 8, // 模拟下载速度\n        uploadThroughput: (20 * 1024) / 8,  // 模拟上传速度 \n        latency: 500 // 模拟延迟（毫秒）\n    },\n    Regular2G: {\n        offline: false,\n        downloadThroughput: (250 * 1024) / 8,\n        uploadThroughput: (50 * 1024) / 8,\n        latency: 300\n    },\n};\n\nasync function setNet(network, page) {\n    // 添加网络环境\n    if (network !== 'default') {\n        // Connect to Chrome DevTools\n        await page._client.send('Network.emulateNetworkConditions', NETWORK_PRESETS[network]);\n    }\n}\n\nconst page = await browser.newPage();\n// 添加网络环境\n// Connect to Chrome DevTools\nawait page._client.send('Network.emulateNetworkConditions', NETWORK_PRESETS['GPRS']);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br")])]),s("h4",{attrs:{id:"如果设置不同gputhrottling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果设置不同gputhrottling"}},[a._v("#")]),a._v(" 如果设置不同GPUThrottling")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("await page._client.send('Emulation.setCPUThrottlingRate', { rate: 4 });\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"一些时间节点判断api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些时间节点判断api"}},[a._v("#")]),a._v(" 一些时间节点判断API")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("// 等待3s\nawait page.waitForTimeout(3000);\n\n// 等待某个元素出现\nawait page.waitForSelector('div > .m-tabwrap');\n\n// 等待某个条件项\nawait page.waitForFunction('window.innerWidth < 100');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"性能分析相关api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能分析相关api"}},[a._v("#")]),a._v(" 性能分析相关API")]),a._v(" "),s("ul",[s("li",[a._v("tracing，生成的json文件可直接拖入ChromeDevTools的performance面板中查看")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("await page.tracing.start({path: 'trace.json', screenshots: true});\nawait page.click('div > .m-tabwrap > .m-tab > li:nth-child(3) > a');\nawait page.waitForTimeout(3000);\nawait page.screenshot({\n\tpath: 'demo1.png'\n});\nawait page.tracing.stop();\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("ul",[s("li",[a._v("通过 page.getMetrics() 可以得到一些页面性能数据")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("const metrics = await page.metrics();\n\n&lt;--Timestamp The timestamp when the metrics sample was taken.--\x3e\n&lt;--Documents 页面文档数--\x3e\n&lt;--Frames 页面 frame 数--\x3e\n&lt;--JSEventListeners 页面内事件监听器数--\x3e\n&lt;--Nodes 页面 DOM 节点数--\x3e\n&lt;--LayoutCount 页面 layout 数--\x3e\n&lt;--RecalcStyleCount 样式重算数--\x3e\n&lt;--LayoutDuration 页面 layout 时间--\x3e\n&lt;--RecalcStyleDuration 样式重算时长--\x3e\n&lt;--ScriptDuration script 时间--\x3e\n&lt;--TaskDuration 所有浏览器任务时长--\x3e\n&lt;--JSHeapUsedSize JavaScript 占用堆大小--\x3e\n&lt;--JSHeapTotalSize JavaScript 堆总量--\x3e\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h4",{attrs:{id:"更多"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更多"}},[a._v("#")]),a._v(" 更多")]),a._v(" "),s("p",[a._v("更多示例可参考官方"),s("a",{attrs:{href:"https://github.com/puppeteer/examples",target:"_blank",rel:"noopener noreferrer"}},[a._v("示例库"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);