<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能监控方案 | Rr&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="my blog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f589b1fd.css" as="style"><link rel="preload" href="/assets/js/app.63e6572e.js" as="script"><link rel="preload" href="/assets/js/2.5853c661.js" as="script"><link rel="preload" href="/assets/js/1.e5f7b0b7.js" as="script"><link rel="preload" href="/assets/js/14.0e4bb1db.js" as="script"><link rel="prefetch" href="/assets/js/10.4e15d136.js"><link rel="prefetch" href="/assets/js/11.36d5b72d.js"><link rel="prefetch" href="/assets/js/12.ce9d641c.js"><link rel="prefetch" href="/assets/js/13.f252ed01.js"><link rel="prefetch" href="/assets/js/15.611b4a46.js"><link rel="prefetch" href="/assets/js/16.7b6314c3.js"><link rel="prefetch" href="/assets/js/17.2de5fef7.js"><link rel="prefetch" href="/assets/js/18.8edb1f0c.js"><link rel="prefetch" href="/assets/js/19.0f686215.js"><link rel="prefetch" href="/assets/js/20.b723be56.js"><link rel="prefetch" href="/assets/js/21.f0730c6b.js"><link rel="prefetch" href="/assets/js/22.0e61f47d.js"><link rel="prefetch" href="/assets/js/23.a626f674.js"><link rel="prefetch" href="/assets/js/24.1eb131bc.js"><link rel="prefetch" href="/assets/js/25.a304b8c8.js"><link rel="prefetch" href="/assets/js/26.78ace1d6.js"><link rel="prefetch" href="/assets/js/27.e390597c.js"><link rel="prefetch" href="/assets/js/28.f74f60d6.js"><link rel="prefetch" href="/assets/js/29.2db0ceaa.js"><link rel="prefetch" href="/assets/js/3.27b60221.js"><link rel="prefetch" href="/assets/js/30.ab8c6391.js"><link rel="prefetch" href="/assets/js/31.fb08fe0c.js"><link rel="prefetch" href="/assets/js/32.88a2dec6.js"><link rel="prefetch" href="/assets/js/33.a215c628.js"><link rel="prefetch" href="/assets/js/34.f7dcdc40.js"><link rel="prefetch" href="/assets/js/35.2c79727f.js"><link rel="prefetch" href="/assets/js/36.320c4085.js"><link rel="prefetch" href="/assets/js/37.ef0e6a38.js"><link rel="prefetch" href="/assets/js/38.425ff37c.js"><link rel="prefetch" href="/assets/js/39.fb2d1ec3.js"><link rel="prefetch" href="/assets/js/4.a2dcb89c.js"><link rel="prefetch" href="/assets/js/40.73dd4d6c.js"><link rel="prefetch" href="/assets/js/41.a82aa888.js"><link rel="prefetch" href="/assets/js/42.1356c985.js"><link rel="prefetch" href="/assets/js/43.a2da7d19.js"><link rel="prefetch" href="/assets/js/44.4b390834.js"><link rel="prefetch" href="/assets/js/45.de05d68c.js"><link rel="prefetch" href="/assets/js/46.858bcc53.js"><link rel="prefetch" href="/assets/js/47.e9bdfdd4.js"><link rel="prefetch" href="/assets/js/48.fcd51222.js"><link rel="prefetch" href="/assets/js/49.c8f68d9c.js"><link rel="prefetch" href="/assets/js/5.c7463708.js"><link rel="prefetch" href="/assets/js/50.3a90bdf2.js"><link rel="prefetch" href="/assets/js/51.f0659f9f.js"><link rel="prefetch" href="/assets/js/52.d7b62681.js"><link rel="prefetch" href="/assets/js/53.3b108e72.js"><link rel="prefetch" href="/assets/js/54.5a3e5a59.js"><link rel="prefetch" href="/assets/js/55.7d06b7d6.js"><link rel="prefetch" href="/assets/js/56.65aa266d.js"><link rel="prefetch" href="/assets/js/57.e5e57a35.js"><link rel="prefetch" href="/assets/js/58.bfd523d9.js"><link rel="prefetch" href="/assets/js/59.a8d998eb.js"><link rel="prefetch" href="/assets/js/6.00ce6dd1.js"><link rel="prefetch" href="/assets/js/60.437165cf.js"><link rel="prefetch" href="/assets/js/61.f326ef58.js"><link rel="prefetch" href="/assets/js/62.38f3a4df.js"><link rel="prefetch" href="/assets/js/63.6bb8eadf.js"><link rel="prefetch" href="/assets/js/64.6665a418.js"><link rel="prefetch" href="/assets/js/65.95efdd65.js"><link rel="prefetch" href="/assets/js/66.813cbf1d.js"><link rel="prefetch" href="/assets/js/67.86b3baff.js"><link rel="prefetch" href="/assets/js/68.29b9fab5.js"><link rel="prefetch" href="/assets/js/69.aea273e4.js"><link rel="prefetch" href="/assets/js/7.0b10c3db.js"><link rel="prefetch" href="/assets/js/70.14482414.js"><link rel="prefetch" href="/assets/js/71.06593dc0.js"><link rel="prefetch" href="/assets/js/72.802f5fc2.js"><link rel="prefetch" href="/assets/js/73.1b02b75c.js"><link rel="prefetch" href="/assets/js/74.e5e1105e.js"><link rel="prefetch" href="/assets/js/75.a005acaf.js"><link rel="prefetch" href="/assets/js/76.d0a45c84.js"><link rel="prefetch" href="/assets/js/77.f58c2a23.js"><link rel="prefetch" href="/assets/js/78.cb51e0f7.js"><link rel="prefetch" href="/assets/js/79.4ce1a629.js"><link rel="prefetch" href="/assets/js/80.318927ea.js"><link rel="prefetch" href="/assets/js/81.b32882b3.js"><link rel="prefetch" href="/assets/js/82.da12ea28.js"><link rel="prefetch" href="/assets/js/83.d37bcd2b.js"><link rel="prefetch" href="/assets/js/84.c8296be2.js"><link rel="prefetch" href="/assets/js/85.21f72ba2.js"><link rel="prefetch" href="/assets/js/86.2ef9983c.js"><link rel="prefetch" href="/assets/js/87.a09638cb.js"><link rel="prefetch" href="/assets/js/88.df1154e8.js"><link rel="prefetch" href="/assets/js/89.faa49b1e.js"><link rel="prefetch" href="/assets/js/90.9d3b3002.js"><link rel="prefetch" href="/assets/js/91.c65648c6.js"><link rel="prefetch" href="/assets/js/92.421d4739.js"><link rel="prefetch" href="/assets/js/93.628bfb4c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d8b3a8c6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f589b1fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Rr's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/skill/web/" class="nav-link router-link-active">
  Web
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/notes/" class="nav-link">
  项目笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工程规范
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/business/standard/common.html" class="nav-link">
  通用规范
</a></li></ul></li><li class="dropdown-item"><h4>
          构建
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/build/babel/" class="nav-link">
  babel
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/tools/" class="nav-link">
  实用工具
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/skill/web/" class="nav-link router-link-active">
  Web
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/notes/" class="nav-link">
  项目笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工程规范
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/business/standard/common.html" class="nav-link">
  通用规范
</a></li></ul></li><li class="dropdown-item"><h4>
          构建
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/build/babel/" class="nav-link">
  babel
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/tools/" class="nav-link">
  实用工具
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/skill/web/tcpip.html" class="sidebar-link">TCP/IP 以及三次握手四次挥手</a></li><li><a href="/skill/web/history.html" class="sidebar-link">history</a></li><li><a href="/skill/web/performanceEntry.html" class="sidebar-link">performance Entry</a></li><li><a href="/skill/web/puppeteer.html" class="sidebar-link">Puppeteer使用</a></li><li><a href="/skill/web/前端性能监控.html" class="active sidebar-link">前端性能监控方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#_1-rail测量模型" class="sidebar-link">1. RAIL测量模型</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#_2-web-vitals" class="sidebar-link">2. Web Vitals</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#_3-其他常用指标" class="sidebar-link">3. 其他常用指标</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#web-vitals" class="sidebar-link">web vitals</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#performance-api" class="sidebar-link">Performance API</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#用户数据采集" class="sidebar-link">用户数据采集</a></li><li class="sidebar-sub-header"><a href="/skill/web/前端性能监控.html#常用实验室评测工具" class="sidebar-link">常用实验室评测工具</a></li></ul></li><li><a href="/skill/web/nginx.html" class="sidebar-link">Nginx代理/反代理</a></li><li><a href="/skill/web/websocket.html" class="sidebar-link">WebSocket</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端性能监控方案"><a href="#前端性能监控方案" class="header-anchor">#</a> 前端性能监控方案</h1> <p>一般来说，前端性能监控会采用两种形式。</p> <ul><li>统计用户测的真实使用数据，sdk采集上报分析，自定义埋点上报</li> <li>实验室合成测试监控，模拟场景和数据</li></ul> <p>实验室合成测试监控:
<img src="/assets/img/1.2197b826.png" alt="image.png">
真实用户监控：
<img src="/assets/img/2.00038609.png" alt="image.png"></p> <p>无论是哪种方式，性能指标的确定都是非常重要的</p> <h1 id="性能指标"><a href="#性能指标" class="header-anchor">#</a> 性能指标</h1> <h2 id="_1-rail测量模型"><a href="#_1-rail测量模型" class="header-anchor">#</a> 1. RAIL测量模型</h2> <h3 id="_1-1-rail测量模型"><a href="#_1-1-rail测量模型" class="header-anchor">#</a> 1. 1 RAIL测量模型</h3> <p>RAIL是一个以用户为中心的性能模型，它把用户的体验拆分成几个关键点（例如，tap，scroll，load），并且帮你定义好了每一个的性能指标。</p> <p>有以下四个方面：</p> <p><img src="/assets/img/3.d36e8d45.png" alt="image.png"></p> <p>以下是用户对性能延迟的感知：</p> <ul><li>小于100毫秒被认为是瞬时的；</li> <li>100ms到300ms的延迟是可感知的；</li> <li>一秒钟是用户思想不被打断的极限；</li> <li>用户希望网站在2秒内加载；</li> <li>3秒后，40%的访问者会放弃你的网站；</li> <li>10秒是保持用户注意力的极限。</li></ul> <h6 id="长任务"><a href="#长任务" class="header-anchor">#</a> 长任务</h6> <ul><li>长任务（执行时间大于 50ms）</li> <li>短任务（执行时间低于 50ms）</li></ul> <h6 id="response-响应"><a href="#response-响应" class="header-anchor">#</a> Response 响应</h6> <ul><li>应该尽可能快速的响应用户的操作，事件处理最好在50ms内完成，在100ms以内响应用户输入。</li> <li>idle task：除了要处理输入事件，浏览器还有其它任务要做，这些任务会占用部分时间，一般情况会花费50ms的时间，输入事件的响应则排在其后。
<img src="/assets/img/4.dc3e73ee.png" alt="image.png"></li></ul> <h6 id="animation-动画"><a href="#animation-动画" class="header-anchor">#</a> Animation 动画</h6> <ul><li>产生每一帧的时间不要超过10ms，为了保证浏览器60帧，每一帧的时间在16ms左右，但浏览器需要用6ms来渲染每一帧。</li> <li>旨在视觉上的平滑。用户对帧率变化感知很敏感。</li></ul> <h6 id="idle-浏览器最大空闲时间"><a href="#idle-浏览器最大空闲时间" class="header-anchor">#</a> Idle 浏览器最大空闲时间</h6> <ul><li>最大化空闲时间，以增大50ms内响应用户输入的几率</li> <li>用空闲时间来完成一些延后的工作，如先加载页面可见的部分，然后利用空闲时间加载剩余部分，此处可以使用 requestIdleCallback API</li> <li>在空闲时间内执行的任务尽量控制在50ms以内，如果更长的话，会影响input handle的pending时间</li> <li>如果用户在空闲时间任务进行时进行交互，必须以此为最高优先级，并暂停空闲时间的任务</li></ul> <h6 id="load-加载"><a href="#load-加载" class="header-anchor">#</a> Load 加载</h6> <ul><li>传输内容到页面可交互的时间不超过5秒</li> <li>对于第二次打开，尽量不超过2秒</li></ul> <h3 id="_1-2-以用户为中心的性能指标"><a href="#_1-2-以用户为中心的性能指标" class="header-anchor">#</a> 1.2 以用户为中心的性能指标</h3> <ul><li>First Paint 首次绘制（FP）</li> <li>First contentful paint 首次内容绘制 (FCP)</li> <li>Largest contentful paint 最大内容绘制 (LCP)</li> <li>First input delay 首次输入延迟 (FID)</li> <li>Time to Interactive 可交互时间 (TTI)</li> <li>Total blocking time 总阻塞时间 (TBT)</li> <li>Cumulative layout shift 累积布局偏移 (CLS)</li></ul> <h4 id="fp-fcp-lcp"><a href="#fp-fcp-lcp" class="header-anchor">#</a> FP &amp; FCP &amp; LCP</h4> <ul><li>FP: 首次绘制，First Paint，这个指标用于记录页面第一次绘制像素的时间。</li> <li>FCP: 首次内容绘制，First Contentful Paint，这个指标用于记录页面首次绘制文本、图片、非空白 Canvas 或 SVG 的时间。</li> <li>LCP：最大内容绘制时间，用于记录视窗内最大的元素绘制的时间
<ul><li>持续更新：该时间会随着页面渲染变化而变化，因为页面中的最大元素在渲染过程中可能会发生改变，另外该指标会在用户第一次交互后停止记录。</li> <li>例子：当页面出现骨架屏或者 Loading 动画时 FCP 其实已经被记录下来了，但是此时用户希望看到的内容其实并未呈现，我们更想知道的是页面主要的内容是何时呈现出来的。</li></ul></li></ul> <h4 id="tti-fid"><a href="#tti-fid" class="header-anchor">#</a> TTI &amp; FID</h4> <ul><li>TTI（Time to Interactive）：首次可交互时间
<ul><li>从 FCP 指标后开始计算</li> <li>持续 5 秒内无长任务（执行时间超过 50 ms）且无两个以上正在进行中的 GET 请求</li> <li>往前回溯至 5 秒前的最后一个长任务结束的时间
<img src="/assets/img/5.3b86e78a.png" alt="image.png"></li></ul></li> <li>FID（First Input Delay）：首次输入延迟，记录在 FCP 和 TTI 之间用户首次与页面交互时响应的延迟。</li></ul> <h4 id="tbt"><a href="#tbt" class="header-anchor">#</a> TBT</h4> <ul><li>TBT（Total Blocking Time）：阻塞总时间，记录在 FCP 到 TTI 之间所有长任务的阻塞时间总和。</li> <li>例子：如果说在 FCP 到 TTI 之间页面总共执行了以下长任务（执行时间大于 50ms）及短任务（执行时间低于 50ms），那么每个长任务的阻塞时间就等于它所执行的总时间减去 50ms
<img src="/assets/img/6.d8dbe92b.png" alt="image.png"></li></ul> <p><img src="/assets/img/7.50eff17c.png" alt="image.png"></p> <h4 id="cls"><a href="#cls" class="header-anchor">#</a> CLS</h4> <p>累计位移偏移，CLS（Cumulative Layout Shift），记录了页面上非预期的位移波动。计算方式为：位移影响的面积 * 位移距离。</p> <h2 id="_2-web-vitals"><a href="#_2-web-vitals" class="header-anchor">#</a> 2. <a href="https://web.dev/vitals/" target="_blank" rel="noopener noreferrer">Web Vitals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>Google 在20年五月提出了网站用户体验的三大核心指标</p> <ul><li><strong>LCP</strong> （Largest Contentful Paint）：最大内容绘制时间，用来衡量加载体验，谷歌要求LCP最好在页面首次开始加载后的2.5秒内发生；</li> <li><strong>FID</strong> （First Input Delay）：首次输入延迟时间，用于衡量页面交互性，谷歌要求页面的FID最好小于100毫秒；</li> <li><strong>CLS</strong> （Cumulative Layout Shift）：累计布局位移，用于衡量视觉稳定性，谷歌要求页面的CLS最好保持小于0.1。
<img src="/assets/img/8.446ad5d6.png" alt="image.png"></li></ul> <h2 id="_3-其他常用指标"><a href="#_3-其他常用指标" class="header-anchor">#</a> 3. 其他常用指标</h2> <ul><li>白屏时间：从浏览器输入地址并回车后到页面开始有内容的时间；</li> <li>首屏时间：从浏览器输入地址并回车后到首屏内容渲染完毕的时间；</li> <li>用户可操作时间节点：domready触发节点，点击事件有反应；</li> <li>总下载时间：window.onload的触发节点。
<img src="/assets/img/9.a8acd2f7.png" alt="image.png"></li></ul> <h1 id="性能指标的测量与计算"><a href="#性能指标的测量与计算" class="header-anchor">#</a> 性能指标的测量与计算</h1> <h2 id="web-vitals"><a href="#web-vitals" class="header-anchor">#</a> web vitals</h2> <p>测量所有核心 Web 指标，最简单的方法是使用web-vitals JavaScript 库，这是一个围绕底层网页 API 的小型的、生产就绪的封装器，通过准确匹配每项指标在上方列出的所有 Google 工具中的报告方式来进行指标测量。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {getCLS, getFID, getLCP} from 'web-vitals';

function sendToAnalytics(metric) {
  const body = JSON.stringify(metric);
  // Use `navigator.sendBeacon()` if available, falling back to `fetch()`.
  (navigator.sendBeacon &amp;&amp; navigator.sendBeacon('/analytics', body)) ||
      fetch('/analytics', {body, method: 'POST', keepalive: true});
}

getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getLCP(sendToAnalytics);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="performance-api"><a href="#performance-api" class="header-anchor">#</a> Performance API</h2> <blockquote><p>Performance API 是前端性能监控中常用的API
Performance API最主要的作用就是支持应用程序中客户端的延时测量。</p></blockquote> <ul><li>常用API</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>performance.getEntries()
performance.getEntriesByName() 
performance.getEntriesByType() 
performance.mark() 
performance.clearMarks() 
performance.measure() 
performance.clearMeasures() 
performance.now()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="performance-api的时间测量与date对象的时间定义的区别"><a href="#performance-api的时间测量与date对象的时间定义的区别" class="header-anchor">#</a> Performance API的时间测量与Date对象的时间定义的区别</h5> <ol><li>精度不同</li></ol> <ul><li>Performance API 是高采样率的，因为其精确度可达千分之一毫秒（受硬件或软件限制）</li> <li>Date 对象则基于 Unix Time Stamp，即自1970年1月1日（UTC）起经过的毫秒数</li></ul> <ol start="2"><li>Performance API 支持单调时钟</li></ol> <ul><li>使用 Date.now() 的差值并非绝对精确，因为计算时间时受系统限制（可能阻塞），有可能会出现 Time1 - Time2 是负值的情况</li> <li>performance.now() 方法返回一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp" target="_blank" rel="noopener noreferrer">DOMHighResTimeStamp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,其时间是以恒定速率递增的，不受系统时间的影响（系统时间可被人为或软件调整）</li></ul> <h5 id="performance-entry"><a href="#performance-entry" class="header-anchor">#</a> Performance Entry</h5> <ul><li>PerformanceEntry 对象代表了 performance 时间列表中的单个 metric 数据.</li> <li>Performance entries 在资源加载的时候，也会被动生成（例如图片、script、css等资源加载）</li> <li>注意：Entries初始150个限制，可通过以下两个API修改
<ul><li>修改上限：setResourceTimingBufferSize(your_number);</li> <li>清除当前保存的Entries：clearResourceTimings()</li></ul></li></ul> <h5 id="获取entry"><a href="#获取entry" class="header-anchor">#</a> 获取Entry</h5> <ul><li>浏览器获取网页时，会对网页中每一个对象（脚本文件、样式表、图片文件等等）发出一个HTTP请求。performance.getEntries方法以数组形式，返回这些请求的时间统计信息，有多少个请求，返回数组就会有多少个成员。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// entry获取</span>
performance<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>
performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> type<span class="token punctuation">)</span>

<span class="token comment">// getEntriesByType() 方法返回给定类型的 PerformanceEntry 列表</span>
<span class="token comment">// performance.getEntriesByType(&quot;resource&quot;)方法为每个请求的资源获取一个资源定时对象数组</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="entry属性与计算"><a href="#entry属性与计算" class="header-anchor">#</a> Entry属性与计算</h5> <p><img src="/assets/img/10.0608e4c4.png" alt="image.png"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>connectEnd：连接结束时间
connectStart：连接开始时间
decodedBodySize：解码的主体大小
domComplete：dom 渲染完成时间
domContentLoadedEventEnd：dom 内容加载事件结束时间
domContentLoadedEventStart：dom 内容加载事件开始时间
domInteractive：dom 交互时间
domainLookupEnd：域查找结束时间
domainLookupStart：域查找开始时间
duration：事件耗时
encodedBodySize：编码主体大小
entryType：资源输入类型
fetchStart：获取资源开始时间
initiatorType：发起人类型
loadEventEnd：加载事件结束时间
loadEventStart：加载事件开始时间
name：这里一般就是当前请求的 url 的地址
nextHopProtocol：下一个跳转协议
redirectCount：重定向次数
redirectEnd：重定向开始时间，如果没有重定向，值为0
redirectStart：重定向结束时间，如果没有重定向，值为0
requestStart：请求开始时间
responseEnd：响应结束时间
responseStart：响应开始时间
secureConnectionStart：安全连接开始时间
serverTiming：服务器时间
startTime：开始时间
transferSize：传递大小
type：该事件的类型
unloadEventEnd：卸载事件结束时间
unloadEventStart：卸载事件开始时间
workerStart：worker 开始时间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>性能计算公式</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DNS查询耗时 = domainLookupEnd - domainLookupStart
TCP链接耗时 = connectEnd - connectStart
request请求耗时 = responseEnd - responseStart
解析dom树耗时 = domComplete - domInteractive
白屏时间 = domloading - fetchStart
domready可操作时间 = domContentLoadedEventEnd - fetchStart
onload总下载时间 = loadEventEnd - fetchStart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="实践-获取未裁剪大图片"><a href="#实践-获取未裁剪大图片" class="header-anchor">#</a> 实践：获取未裁剪大图片</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>export const getBigImgEntries = (oldUrl) =&gt; {
    const entryList = window.performance.getEntriesByType('resource');
    let bigImgList = entryList.filter(entry =&gt; {
        // entry.initiatorType === 'img'
        // 筛选未配置裁剪参数的图片，即为未处理的大图
        // 配置了裁剪参数的，则比较图片尺寸，与imgdom尺寸是否误差较大
        // const imgdom = document.querySelector('img[src=&quot;'+ imgEntry.name +'&quot;]') 
    });
    if (!bigImgList.length) return null;
    return bigImgList;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="数据采集"><a href="#数据采集" class="header-anchor">#</a> 数据采集</h1> <h2 id="用户数据采集"><a href="#用户数据采集" class="header-anchor">#</a> 用户数据采集</h2> <p><img src="/assets/img/11.8b02ed3f.png" alt="image.png"></p> <h4 id="sdk采集"><a href="#sdk采集" class="header-anchor">#</a> sdk采集</h4> <ul><li>使用 puzzle 接入 SDK 进行监控，可覆盖前期版本。适用于通用数据采集，但部分特殊场景监控项不适用。</li> <li>SDK 开发流程
<img src="/assets/img/12.7ab9f470.png" alt="image.png"></li> <li>SDK开发注意点
<ul><li>版本控制
<ul><li>采样率
<ul><li>每个监控项，PUZZLE分别配置采样率</li></ul></li> <li>SDK静态文件
<ul><li>静态部署平台部署生成</li> <li>缓存：SDK版本升级规则</li></ul></li> <li>数据存储隔离
<ul><li>测试 &amp; 生产环境 数据隔离</li> <li>上报字段区分，测试‘xxxx–beta</li></ul></li></ul></li> <li>上报数据，可聚合字段，</li> <li>无效数据过滤，保证数据准确性，可进行预处理</li> <li>避免影响应用性能</li></ul></li> <li>性能以外的指标
<ul><li>版本分布</li> <li>位置信息</li> <li>设备信息</li> <li>接口监控</li> <li>PV/UV</li></ul></li></ul> <h4 id="自定义埋点上报"><a href="#自定义埋点上报" class="header-anchor">#</a> 自定义埋点上报</h4> <ul><li>无法覆盖前期版本，但成本低，操作简单，场景灵活</li></ul> <h2 id="常用实验室评测工具"><a href="#常用实验室评测工具" class="header-anchor">#</a> 常用实验室评测工具</h2> <ul><li><ol><li><a href="https://webpagetest.org/easy" target="_blank" rel="noopener noreferrer">WebPage Test<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></li> <li><ol start="2"><li><a href="https://github.com/GoogleChrome/lighthouse" target="_blank" rel="noopener noreferrer">LightHouse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" target="_blank" rel="noopener noreferrer">插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>使用npm包lighthouse</li></ul></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install -g lighthouse
lighthouse http://www.baidu.com/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><ol start="3"><li><a href="https://developers.google.com/web/tools/chrome-devtools" target="_blank" rel="noopener noreferrer">Chrome DevTools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></li> <li><ol start="4"><li><a href="/skill/web/puppeteer.html">Puppeteer</a></li></ol></li></ul> <h1 id="数据可视化"><a href="#数据可视化" class="header-anchor">#</a> 数据可视化</h1> <ul><li>图表化</li> <li>多维度：时间、版本、比例</li> <li>对照分析</li> <li>自定义埋点自动生成图标</li></ul> <h1 id="数据分析与用户反馈"><a href="#数据分析与用户反馈" class="header-anchor">#</a> 数据分析与用户反馈</h1> <ul><li>形成评分体系</li> <li>以比例和分值进行具体评判</li> <li>自动定期推送用户</li> <li>工程质量治理</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/skill/web/puppeteer.html" class="prev">
        Puppeteer使用
      </a></span> <span class="next"><a href="/skill/web/nginx.html">
        Nginx代理/反代理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.63e6572e.js" defer></script><script src="/assets/js/2.5853c661.js" defer></script><script src="/assets/js/1.e5f7b0b7.js" defer></script><script src="/assets/js/14.0e4bb1db.js" defer></script>
  </body>
</html>
